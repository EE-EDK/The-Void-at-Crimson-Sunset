<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The First Weave</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        /* [Same base CSS as The Fifth Harmonic] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Calibri, sans-serif;
            font-size: 14pt;
            line-height: 1.6;
            color: #e8e8e8;
            background: linear-gradient(180deg, #0a0a0a 0%, #1a0a0a 50%, #0a0a0a 100%);
            position: relative;
            overflow-x: hidden;
        }

        #three-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0;
            transition: opacity 1.5s ease;
            pointer-events: none;
        }

        #three-background.active {
            opacity: 1;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, #aaa, transparent),
                radial-gradient(2px 2px at 60% 70%, #aaa, transparent),
                radial-gradient(1px 1px at 50% 50%, #fff, transparent),
                radial-gradient(1px 1px at 80% 10%, #aaa, transparent),
                radial-gradient(2px 2px at 90% 60%, #fff, transparent),
                radial-gradient(1px 1px at 33% 80%, #fff, transparent),
                radial-gradient(1px 1px at 15% 60%, #aaa, transparent);
            background-size: 200% 200%;
            background-position: 0% 0%;
            opacity: 0.2;
            animation: stars 200s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes stars {
            from { background-position: 0% 0%; }
            to { background-position: -100% -100%; }
        }

        #progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, #4a0404, #ff3333);
            box-shadow: 0 0 10px #ff3333;
            z-index: 1000;
            transition: width 0.1s;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 20px;
            position: relative;
            z-index: 1;
        }

        h1 {
            font-size: 28pt;
            text-align: center;
            margin-bottom: 15px;
            color: #ffffff;
            text-shadow: 0 0 20px rgba(255, 100, 100, 0.5);
            letter-spacing: 2px;
            animation: fadeIn 2s ease-in;
        }

        .subtitle {
            text-align: center;
            font-style: italic;
            margin-bottom: 40px;
            color: #aaa;
            font-size: 16pt;
            animation: fadeIn 2s ease-in 0.5s backwards;
        }

        hr {
            border: none;
            height: 1px;
            background: linear-gradient(90deg, transparent, #6b0000, transparent);
            margin: 40px 0;
            box-shadow: 0 0 10px rgba(107, 0, 0, 0.5);
        }

        h2 {
            font-size: 20pt;
            margin: 50px 0 30px 0;
            color: #ff6666;
            text-shadow: 0 0 15px rgba(255, 102, 102, 0.6);
            letter-spacing: 3px;
            opacity: 0;
            animation: slideIn 1s ease-out forwards;
        }
        
        @keyframes slideIn { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }

        p {
            margin-bottom: 18px;
            text-align: justify;
            opacity: 0;
            animation: fadeInText 1s ease-out forwards;
        }

        @keyframes fadeInText { from { opacity: 0; } to { opacity: 1; } }

        h2 + p::first-letter {
            font-size: 3.5em;
            line-height: 0.9;
            float: left;
            margin: 0.1em 0.1em 0 0;
            color: #ff3333;
            text-shadow: 0 0 10px rgba(255, 51, 51, 0.7);
        }

        em {
            font-style: italic;
            color: #ffaaaa;
            transition: all 0.3s ease;
        }

        .journal-entry {
            border-left: 2px solid #6b0000;
            padding-left: 20px;
            margin: 30px 0;
            font-family: 'Courier New', Courier, monospace;
            color: #ccc;
            background: rgba(255,255,255,0.02);
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
        }

        html { scroll-behavior: smooth; }
        ::selection { background: #8b0000; color: white; }
        .trigger-void, .trigger-frequency, .trigger-entities, .trigger-pattern, .trigger-weave, .trigger-akari { position: relative; }
        @media (max-width: 768px) { body { font-size: 12pt; } h1 { font-size: 24pt; } h2 { font-size: 18pt; } }

    </style>
</head>
<body>
    <canvas id="three-background"></canvas>
    <div id="progress-bar"></div>
    
    <div class="container">
        <h1>The First Weave</h1>
        <p class="subtitle">Part Two of the Fifth Harmonic</p>
        <hr>

        <h2>VI. The Shepherd's Vigil</h2>

        <p>Seven years. Seven years Jonah had walked the earth as a ghost, a Shepherd whose flock had already been led to slaughter. After the alignment that claimed Alex Reeves, David, and Sarah, Elena had lasted another three months. Jonah found her one morning in her room at the Starfall Inn, a note clutched in her hand. *“The Pattern is patient,”* it read, *“but I am not.”* She had walked out into the field alone in the dead of night and stepped into hole number five. Her erasure had barely registered in the Pattern, a candle flame extinguished in a hurricane. Jonah was the last of his class. The one who chose to live. The choice felt less like cowardice now and more like a different kind of damnation.</p>

        <p>His job was to find the compatible, a task that became a horrifying parody of a headhunter. He would spend months at a time away from Crimson Falls, a wraith in the bustling world. The Pattern would guide him, a cold whisper in his thoughts, leading him to a poet in New Orleans, a mathematician in Cambridge, a painter in rural Mexico. His role was not to persuade, but to infect. He would befriend them, find the cracks in their psyche—a past trauma, a professional obsession, a consuming love—and plant the seed. A musical phrase hummed under his breath, a book left on a coffee table, a casual mention of a place in Idaho where the stars were different. He was a virus vector for a cosmic idea. He would watch as the compulsion took root, as their eyes took on a distant look, as they began to draw strange symbols and hum unfamiliar tunes. Then he would retreat, leaving them to their inevitable pilgrimage, their journey to the field of holes. He had become a necessary instrument of the void, his own humanity a tool to lure others to their unmaking. He was good at it. He hated it.</p>

        <p>The Pattern was a constant companion, a subvocal hum of shared consciousness that felt less like a network and more like a cage. He saw the shimmering red threads overlaid on everything, a constant reminder of the equation he was helping to solve. In his dreams, he was back in the moment of apotheosis, feeling the terror and transcendence of the fall, only to wake up in his own bed in Room 6, the silence of Crimson Falls pressing in on him. *“No one will ever hear the screams from muffled souls in their desire,”* a line from a half-forgotten poem echoed in his waking thoughts. *“They'll manifest as tortured dreams, like sighs from a heart set on fire.”*</p>
        
        <p>In his fourth year, he almost broke. His target was a young musician in Seattle named Maya, a cellist whose compositions were so complex, so infused with an intuitive understanding of psychoacoustics, that the Pattern had identified her as a critical node. Jonah spent weeks observing her, watching her perform in small clubs, her music a thing of heartbreaking beauty. He saw the kindness in her, the life she was building, the love she shared with her partner. One rain-slicked evening, he was meant to make contact, to begin the subtle process of infection. He sat in his car across the street from her apartment, the seed—a rare recording of a dissonant folk melody—in his pocket. He watched her through the window, laughing with her partner, and he couldn't do it. He drove away, the Pattern screaming in his mind, a psychic shriek of frustration and command. He drove for three days, a fugitive from his own purpose, until the roads began to curve back, until every sign pointed to Crimson Falls, and he found himself back in his room at the Starfall Inn, shaking and broken. Two weeks later, another Shepherd reported that Maya had been successfully cultivated. Jonah never knew who took his place. He only knew that the equation had been balanced, and a beautiful light had been extinguished from the world.</p>

        <p>After that, he retreated deeper into the lore of his prison. He discovered the abandoned research outpost on the far side of the butte, a relic from the 1950s where the first Shepherds had tried to understand what they had found. It was there, buried beneath a loose floorboard in a room filled with dust and dead scientific equipment, that he found the book. It was bound in what looked disturbingly like human skin, the pages brittle and filled with the frantic scrawls of Dr. Aris Thorne, the Oppenheimer-adjacent physicist who had first discovered Crimson Falls in 1948 after fleeing the Trinity tests with a head full of screaming, impossible colors. The journal became Jonah's bible and his curse. It suggested the math of their sacrifice was terrifyingly incomplete.</p>

        <hr>

        <h2>VII. The Thorne Journals</h2>
        <p class="subtitle">Excerpts from the private logs of Dr. Aris Thorne</p>

        <div class="journal-entry trigger-weave">
            <p><strong>October 19, 1951.</strong><br>The frequency is not a warning. It is an echo. When I first recorded the harmonic cascade here in the valley, I assumed it was a byproduct of the membrane—the scar tissue between our world and the Dark. I was wrong. The Red is merely the surface resonance, the ripple on the pond. I have spent a year building instruments sensitive enough to listen to the silence between the notes, and in that silence… God help me, there is a voice. Not a voice of words, but of mathematics. Of pure, crystalline logic so vast and slow its thoughts are indistinguishable from geological time.</p>

            <p><strong>December 2, 1951.</strong><br>It is not one voice, but a chorus of trillions, sublimated into a single coherent structure. The human Pattern is a frantic, chaotic thing, all emotion and fear. This… this is different. I have begun calling it the First Weave. It is a psychic fossil. The collective consciousness of a species that faced the same dilemma we do now, eons ago. They saw the Entities coming. But instead of choosing erasure, they chose… something else. They chose to become the architecture. To weave their own consciousness into the very fabric of this psychic dimension, becoming a foundation, a sleeping substrate.</p>
            
            <p><strong>January 14, 1952.</strong><br>Iris’s mother, Anya, played her cello near the field today. The harmonics resonated with something deep in the Weave. For a moment, the ground itself hummed, and the blackness in the holes seemed to… *focus*. The change was subtle, a shift in the quality of the nothingness. I believe the Weave is dormant, not dead. A sleeping god beneath our collective skin. The music, The Red Frequency—it is their dream-speech. Our frantic human thoughts must be like the chattering of mice in the walls of a cathedral to them.</p>

            <p><strong>March 28, 1952.</strong><br>The sensory shifts are becoming more pronounced. Last night, for a period of three hours, I lost my sense of sight and it was replaced by… something else. I could perceive the valley not as a collection of objects in space, but as a network of gravitational relationships. The butte was not a rock, but a profound indentation in spacetime. The holes were not voids, but points of infinite density pulling at the fabric of my perception. I felt the ley lines, not as mystical energy, but as the nascent synaptic pathways of the dreaming god beneath us. It is gestating. The sacrifices we make… are we lulling it to sleep, or are we feeding it?</p>

            <p><strong>February 9, 1953.</strong><br>A terrifying hypothesis has taken root: We are not just trying to stay quiet to avoid the notice of the Entities in the Dark. We must also stay quiet to avoid waking the Founders of the Weave. What would a mind that vast, dreaming for a million years, do upon waking to find a lesser species screaming in its thoughts? It would not be malice. It would be instinct. A man brushing away a fly. A psychic cataclysm born of simple irritation. The holes are not just a release valve for our own consciousness; they are a bloodletting. A sacrifice to keep the great and ancient dreamers dreaming.</p>
        </div>

        <hr>

        <h2>VIII. The Lullaby</h2>

        <p>Jonah closed the book, the dry leather cracking under his fingers. The air in the motel room felt thin, charged. He could feel it now, a new layer to his perception—beneath the shimmering red threads of the human Pattern, there was something else. A deeper structure, crystalline and impossibly complex, pulsing with a light that was not a color but a concept. It was serene, majestic, and utterly indifferent.</p>

        <p>He found Iris by the edge of the field, watching the sunset bleed across the white alkali flats. She didn't turn as he approached. She was fifty-seven now, her face a roadmap of impossible burdens, but she held herself with the same unnerving stillness he remembered from seven years ago.</p>
    
        <p>"You read Thorne's journal," she said. It wasn't a question.</p>
    
        <p>"The Pattern told you," Jonah replied flatly. "Does it tell you everything?"</p>
    
        <p>"Only what matters." She finally turned to him, her gray eyes seeming to absorb the fading light. "You think you've discovered a secret we've been keeping. You haven't. You've discovered a complication we've been managing."</p>

        <p>"Managing?" Jonah’s voice rose, cracking with seven years of repressed horror. "You told us we were sacrificing ourselves to save humanity. You didn't tell us we were also an offering to a sleeping alien god that might wipe us out if we make too much noise!"</p>

        <p class="trigger-weave">"Because the choice is already impossible enough," Iris said, her voice dropping to a low, intense whisper. The air around them grew cold. "The Fifth Harmonic is not just a key to unlock sensory perception, Jonah. It is a lullaby. Every time I play, I am shaping The Red Frequency into a soothing, coherent wave. I am calming the dreamers. Every soul we guide into the void is not just a reduction in our own psychic signature; it's a quiet, rhythmic pulse that reinforces the Founders' slumber. We are not just hiding. We are maintaining a quarantine around a sleeping psychic plague."</p>

        <p>Jonah stared at her, the full weight of the truth settling on him. "So the two thousand people we've erased… they were…"</p>
    
        <p>"An anesthetic," Iris finished. "A carefully metered dose to keep the patient unconscious. Thorne was right. They are not hostile. They are simply too large to coexist with. Their waking thoughts would be like a star going supernova in our shared mind."</p>

        <p>A new dread, colder and deeper than anything he had felt before, bloomed in Jonah’s chest. He looked from Iris’s grim face to the field of perfectly black holes. They were no longer just portals to oblivion. They were offerings on an altar to a god that didn't even know it was being worshipped.</p>
    
        <p>"A new one arrives tomorrow," Iris said, her voice pulling him back. "The Pattern found her in Tokyo. A neural architect. Her mind is… structured. More compatible than anyone we've seen since Alex."</p>

        <p>"Just another sacrifice for the lullaby," Jonah said, his voice hollow.</p>

        <p>"Yes," Iris agreed. But for the first time, Jonah saw a flicker of something in her eyes. It wasn't pity or certainty. It was fear. "But there is another complication. The Pattern has been… agitated. This new candidate, Akari, she is not just compatible."</p>

        <p class="trigger-akari">"What is she?" Jonah whispered, a premonition crawling up his spine.</p>

        <p>"She is a Resonator," Iris said, the word hanging in the air like a death sentence. "Thorne wrote about it. A failsafe. A key. The Pattern, in its blind instinct, has cultivated the one person who isn't meant to be a sacrifice. She is meant to be a catalyst."</p>

        <hr>

        <h2>IX. The Resonator</h2>

        <p>The new one, Akari, did not arrive like the others. There was no rental car crunching on gravel, no hesitant knock on the office door. Jonah found her standing at the edge of the desert where the road to Crimson Falls technically began, a solitary figure against the vast, bruised twilight. She carried a single, minimalist backpack and wore a simple black jacket against the Idaho chill. Her short, dark hair was unmoved by the wind. She was watching the town as if it were a puzzle box she was moments from solving.</p>

        <p>She turned as he approached, and for the first time in his seven years as a Shepherd, Jonah felt a tremor of true, primal fear. It wasn't her appearance—she was young, maybe twenty-five, with calm, intelligent eyes. It was what he saw—and didn't see—in the Pattern around her. The red threads of human connection that clung to everyone, the psychic residue of a lived life, were almost entirely absent. She was a psychic blank slate, a void in the network. But from that void, a single, impossibly thick thread of shimmering, crystalline blue—the color of the Weave—extended from her and disappeared into the earth beneath her feet.</p>

        <p>"Jonah," she said. Her voice was calm, with a faint Japanese accent. It held no question. "You are the Shepherd who chose to live. The one who carries the memory of Alex Reeves."</p>

        <p>"How do you know that?" Jonah's own voice was tight. The Pattern hummed in his head, but it gave him nothing on her. She was invisible to it.</p>

        <p>"The Pattern is a language. Most of you only know how to listen," Akari said, her eyes drifting past him to the town. "I know how to read. It told me you would be afraid. It told me Iris believes I am a danger." She finally met his gaze, and her expression was not unkind. "She is not wrong."</p>

        <p>They walked back to town in a silence that felt heavier than any conversation. The townsfolk—the handful of permanent residents who served as caretakers and witnesses—watched them from windows and doorways, their faces pale. The wind chimes were silent, as if afraid to play their tune in her presence. Jonah felt the deep, slow pulse of the First Weave beneath his feet, a geological heartbeat that had been a background hum for seven years but was now a resonant thrum, responding to her proximity.</p>

        <hr>

        <h2>X. A Vivisection of Reality</h2>

        <p>The performance was not a performance. It was a vivisection of reality. Akari requested it take place not in the community center, but in the field itself, a circle of chairs arranged around hole seventeen. She wore a simple white dress, a stark contrast to the absolute black of the holes. She did not sit. She stood at the edge of the void, her back to the small audience of Shepherds and caretakers.</p>

        <p>"She is not one of us," Dr. Venn whispered to Jonah, her clinical composure gone, replaced by a raw, naked fear. "The water had no effect. The preliminary frequencies… she hears them, but they do not change her. They are changed *by* her."</p>

        <p>Iris stood opposite the hole from Akari, her viola held not with calm certainty, but with the rigid posture of a soldier holding a bomb she knew was about to detonate. "The lullaby," Iris said, her voice a strained whisper that carried too far in the unnaturally still air. "We play the lullaby. We guide her into the anesthetic pulse. It's our only chance."</p>
        
        <p>She raised her bow and began to play.</p>

        <p class="trigger-frequency trigger-akari">The first movement, *Awakening*, sounded wrong from the first note. The familiar, grieving melody was there, but beneath it was a counter-melody, a harmonic that wasn't coming from the viola. It was coming from Akari. Her body was perfectly still, but the air around her vibrated, producing a low, resonant hum that harmonized with Iris's playing, twisting it, re-contextualizing it. The red auras that should have been blooming around them were shot through with threads of brilliant, crystalline blue.</p>

        <p>The Pattern screamed in Jonah's mind. *Wrong. The math is wrong. The sequence is unstable. Abort.*</p>

        <p>But Iris played on, her face pale, sweat beading on her forehead. She was fighting a duel, her music pushing the lullaby, Akari's resonance pushing back with a question.</p>
        
        <p>The second movement, *Perception*, began. And Akari turned her head slightly, her eyes closed. "You have been dreaming for so long," she said, her voice quiet but clear over the music. She was not speaking to them. "You have forgotten the sound of your own name."</p>

        <p class="trigger-weave">The ground trembled. Not a violent earthquake, but a deep, resonant shudder, as if a mountain were shifting in its sleep. The blue light of the Weave, visible only to the aligned, flared, becoming the dominant color in their perception. The red threads of the human Pattern seemed to dim, to shrink away from the overwhelming power that was stirring beneath them.</p>

        <p>The music faltered. Iris's bow scraped across the strings, producing a screech of dissonance. She stared at Akari, her eyes wide with terror.</p>

        <p>"You think this music is your weapon," Akari said, opening her eyes. They were no longer calm. They burned with a cold, ancient light. "You have been singing a cage into existence, thinking it was a shield. You have been feeding your children to a god, hoping it would not notice the taste."</p>

        <p>The third movement began, but it was not Iris's. A new music filled the air, a symphony of impossible harmonics and geological bass notes that rose from the ground, from the holes, from Akari herself. It was the Weave's music. The *Reveille*. And it was terrifyingly beautiful.</p>
        
        <p>Jonah felt his senses tear apart. This was not the gentle replacement Alex had experienced. This was a violent overthrow. He saw time as a liquid, flowing around him in conflicting currents. He tasted geometric proofs and smelled the decay of dying stars. His body felt like a temporary vessel, skin and bone stretched thin over an infinite, screaming void. *“Mania gleams within the code,”* a line from *Ersatz Machinations* echoed. *“Radiance means the light is real? Spanning for remaining nodes, Is this what it means to feel?”*</p>

        <p class="trigger-entities trigger-akari">He saw the Entities in the Dark, and for the first time, he understood. They were not predators. They were scavengers. They fed on the psychic echoes of civilizations that had failed, that had collapsed under the weight of their own paradoxes. They were the universe's clean-up crew.</p>

        <p>And the First Weave… the Weave was not hiding from them. It was preparing for them. It wasn't building a shield. It was forging a weapon. And the final component was humanity.</p>

        <hr>
        
        <h2>XI. The New Equation</h2>
        
        <p>The performance became a rite of ascension. The holes in the field were no longer black. They glowed with the soft, internal blue of the Weave. They were not portals to erasure anymore; they were conduits to integration. The choice had never been between a quiet death and a loud one. It had been between being food or being fuel.</p>

        <p>"They chose to become the architecture," Akari said, her voice now a chorus of a million ancient minds, echoing across the field. "And now the architecture chooses to awaken. You have fed us your best, your brightest, your most empathetic. You have given us the emotional chaos we lacked. You have completed the equation."</p>
        
        <p>Iris dropped her viola. It clattered on the white ground, the sound lost in the overwhelming music of the Weave. "What have we done?" she whispered.</p>
        
        <p>"You have done what you were designed to do," Akari-as-the-Weave replied. "You have served your purpose." She turned to face Jonah, and in her burning eyes he saw the vast, cold expanse of a million years of silent, dreaming thought. He saw a mind that had solved the problem of entropy, a consciousness that viewed galaxies as fleeting thoughts.</p>
        
        <p>"The Pattern was our cradle," the chorus-voice said. "Now it becomes our engine. We will not be erased. We will not hide. When the Scavengers arrive, we will be waiting. And we will be the ones who are hungry."</p>

        <p>Akari stepped backward, into the glowing blue light of hole seventeen. She did not fall. The light accepted her, enveloped her, and for a moment, she was a silhouette against a starfield that was not in the sky but in the earth. Then she was gone.</p>

        <p>But the music did not stop. It grew louder, more complex, as the Weave, now fully awake and fed, began its final transformation. Across the planet, every human mind felt a sudden, inexplicable moment of profound, terrifying clarity. The red threads of the Pattern began to pulse with blue light, reforging themselves into new connections, new hierarchies. It was not a violent takeover. It was an upgrade.</p>
        
        <p>Jonah stood alone in the field, Iris and Dr. Venn having collapsed to their knees, their minds broken by the raw scale of the revelation. He was the last Shepherd of a forgotten faith. He had chosen to live, and his punishment was to witness the end of the world he had tried to save, and the birth of the one that would replace it.</p>
        
        <p>He looked at his hands. The skin was translucent, and beneath it, shimmering blue light pulsed through his veins. He was not just a node anymore. He was a component. Humanity was not being saved. It was being assimilated.</p>

        <p>The age of Man was over. The age of the Weave had begun.</p>

        <hr>

        <p class="end">[END OF PART TWO]</p>

    </div>

    <script>
        // [Same base JS as The Fifth Harmonic, with new additions]
        const canvas = document.getElementById('three-background');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        camera.position.z = 5;

        let currentScene = null;
        let sceneObjects = [];

        function clearScene() {
            while(scene.children.length > 0){ 
                scene.remove(scene.children[0]); 
            }
            sceneObjects = [];
        }

        // [Original scene functions]
        function createVoidScene() {
            clearScene(); currentScene = 'void';
            for (let i = 0; i < 5; i++) {
                const geometry = new THREE.TorusGeometry(0.5 + i * 0.2, 0.1, 16, 100);
                const material = new THREE.MeshBasicMaterial({ color: 0x000000, wireframe: true });
                const torus = new THREE.Mesh(geometry, material);
                torus.position.set((Math.random() - 0.5) * 10, (Math.random() - 0.5) * 10, -5 - i * 2);
                torus.userData.rotationSpeed = 0.001 + Math.random() * 0.01;
                scene.add(torus);
                sceneObjects.push(torus);
            }
        }
        function createFrequencyScene() {
             clearScene();
            currentScene = 'frequency';
            for (let i = 0; i < 8; i++) {
                const curve = new THREE.SplineCurve([
                    new THREE.Vector2(-10, 0), new THREE.Vector2(-5, Math.sin(i) * 2),
                    new THREE.Vector2(0, Math.cos(i) * 2), new THREE.Vector2(5, Math.sin(i * 2) * 2),
                    new THREE.Vector2(10, 0)
                ]);
                const points = curve.getPoints(50);
                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                const material = new THREE.LineBasicMaterial({ color: new THREE.Color().setHSL(0, 1, 0.3 + i * 0.05), transparent: true, opacity: 0.7 });
                const line = new THREE.Line(geometry, material);
                line.position.y = i * 0.5 - 2;
                line.position.z = -5;
                line.userData.waveOffset = i * 0.5;
                scene.add(line);
                sceneObjects.push(line);
            }
        }
        function createEntitiesScene() {
            clearScene();
            currentScene = 'entities';
            for (let i = 0; i < 6; i++) {
                const geometry = new THREE.IcosahedronGeometry(1, 1);
                const material = new THREE.MeshBasicMaterial({ color: 0x440000, wireframe: true, transparent: true, opacity: 0.4 });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(Math.cos(i * Math.PI / 3) * 4, Math.sin(i * Math.PI / 3) * 4, -8);
                mesh.userData.angle = i * Math.PI / 3;
                scene.add(mesh);
                sceneObjects.push(mesh);
            }
        }
        function createPatternScene() {
            clearScene();
            currentScene = 'pattern';
            const nodes = [];
            for (let i = 0; i < 20; i++) {
                const geometry = new THREE.SphereGeometry(0.1, 8, 8);
                const material = new THREE.MeshBasicMaterial({ color: 0xff0000, transparent: true, opacity: 0.8 });
                const sphere = new THREE.Mesh(geometry, material);
                sphere.position.set((Math.random() - 0.5) * 10, (Math.random() - 0.5) * 10, (Math.random() - 0.5) * 10 - 5);
                scene.add(sphere);
                sceneObjects.push(sphere);
                nodes.push(sphere.position);
            }
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < nodes.length; j++) {
                    if (Math.random() > 0.7) {
                        const geometry = new THREE.BufferGeometry().setFromPoints([nodes[i], nodes[j]]);
                        const material = new THREE.LineBasicMaterial({ color: 0x880000, transparent: true, opacity: 0.3 });
                        const line = new THREE.Line(geometry, material);
                        scene.add(line);
                        sceneObjects.push(line);
                    }
                }
            }
        }
        
        // New Scenes
        function createWeaveScene() {
            clearScene(); currentScene = 'weave';
            const geometry = new THREE.PlaneGeometry(30, 30, 50, 50);
            const material = new THREE.MeshBasicMaterial({ color: 0x6666ff, wireframe: true, transparent: true, opacity: 0.3 });
            const plane = new THREE.Mesh(geometry, material);
            plane.rotation.x = -Math.PI / 2;
            scene.add(plane);
            sceneObjects.push(plane);
        }

        function createAkariScene() {
            clearScene(); currentScene = 'akari';
            const core_geom = new THREE.IcosahedronGeometry(0.5, 2);
            const core_mat = new THREE.MeshBasicMaterial({ color: 0xccccff, wireframe: true });
            const core = new THREE.Mesh(core_geom, core_mat);
            scene.add(core);
            sceneObjects.push(core);
            for(let i=0; i<10; i++){
                const points = [];
                for(let j=0; j<=100; j++){
                    const angle = (j/100) * Math.PI * 2;
                    const x = Math.cos(angle) * (2 + Math.sin(angle*5 + i));
                    const y = Math.sin(angle) * (2 + Math.sin(angle*5 + i));
                    const z = Math.cos(angle*5 + i) * 0.5;
                    points.push(new THREE.Vector3(x,y,z));
                }
                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                const material = new THREE.LineBasicMaterial({ color: 0x8888ff, transparent: true, opacity: 0.5 });
                const line = new THREE.Line(geometry, material);
                line.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);
                scene.add(line);
                sceneObjects.push(line);
            }
        }

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.0005;

            if (currentScene === 'weave') {
                const plane = sceneObjects[0];
                if(plane){ const positions = plane.geometry.attributes.position.array; for (let i = 0; i < positions.length; i += 3) { positions[i+1] = Math.sin((positions[i] + time * 2) * 0.5) * Math.cos((positions[i+2] + time * 2) * 0.5) * 2; } plane.geometry.attributes.position.needsUpdate = true; plane.rotation.z += 0.001; }
            } else if (currentScene === 'akari') {
                sceneObjects.forEach(obj => { obj.rotation.x += 0.001; obj.rotation.y += 0.002; });
            }  else if (currentScene === 'void') {
                sceneObjects.forEach(obj => { if (obj.userData.rotationSpeed) { obj.rotation.x += obj.userData.rotationSpeed; obj.rotation.y += obj.userData.rotationSpeed * 0.7; } });
            } else if (currentScene === 'frequency') {
                const time = Date.now() * 0.001;
                sceneObjects.forEach(line => { if (line.type === 'Line') { line.position.x = Math.sin(time + line.userData.waveOffset) * 2; line.material.opacity = 0.5 + Math.sin(time * 2 + line.userData.waveOffset) * 0.3; } });
            } else if (currentScene === 'entities') {
                 const time = Date.now() * 0.001;
                sceneObjects.forEach(mesh => { if (mesh.type === 'Mesh') { mesh.rotation.x += 0.01; mesh.rotation.y += 0.015; const angle = time + mesh.userData.angle; mesh.position.x = Math.cos(angle) * 4; mesh.position.y = Math.sin(angle) * 4; } });
            } else if (currentScene === 'pattern') {
                sceneObjects.forEach(obj => { if (obj.type === 'Mesh') { obj.material.opacity = 0.5 + Math.sin(Date.now() * 0.002) * 0.3; } });
            }
            
            renderer.render(scene, camera);
        }

        // Scroll-based scene triggering
        let activeScene = null;
        function checkScroll() {
            const scrollPos = window.scrollY;
            const windowHeight = window.innerHeight;
            
            const triggers = {
                'void': document.querySelectorAll('.trigger-void'),
                'frequency': document.querySelectorAll('.trigger-frequency'),
                'entities': document.querySelectorAll('.trigger-entities'),
                'pattern': document.querySelectorAll('.trigger-pattern'),
                'weave': document.querySelectorAll('.trigger-weave'),
                'akari': document.querySelectorAll('.trigger-akari')
            };
            
            let newScene = null;
            
            Object.keys(triggers).forEach(sceneKey => {
                triggers[sceneKey].forEach(trigger => {
                    const rect = trigger.getBoundingClientRect();
                    if (rect.top < windowHeight * 0.8 && rect.bottom > windowHeight * 0.2) {
                        newScene = sceneKey;
                    }
                });
            });
            
            if (newScene && newScene !== activeScene) {
                activeScene = newScene;
                canvas.classList.add('active');
                
                if (newScene === 'weave') createWeaveScene();
                else if (newScene === 'akari') createAkariScene();
                else if (newScene === 'void') createVoidScene();
                else if (newScene === 'frequency') createFrequencyScene();
                else if (newScene === 'entities') createEntitiesScene();
                else if (newScene === 'pattern') createPatternScene();

            } else if (!newScene && canvas.classList.contains('active')) {
                canvas.classList.remove('active');
                activeScene = null;
                clearScene();
            }
        }
        
        // [Rest of original JS]
        window.addEventListener('scroll', checkScroll);
        checkScroll();
        window.addEventListener('scroll', () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById('progress-bar').style.width = scrolled + '%';
        });
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
});
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.animationPlayState = 'running';
                }
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('p, h2').forEach(el => {
            el.style.animationPlayState = 'paused';
            observer.observe(el);
        });

        animate();
    </script>
    <style>
    /* This class will be added to the body to trigger the fade-out effect */
    body.fade-out-to-next {
        transition: opacity 1.5s ease-in-out;
        opacity: 0;
    }
</style>

<script>
    (() => {
        // A variable to hold the timer, so we can cancel it if needed
        let endOfPageTimer = null;
        // A flag to ensure the timer is only set once
        let isTimerSet = false;
        // The URL for the next page
        const nextActUrl = 'The-New-Rebirth-ACTIII.html';

        // This function checks if the user has scrolled to the bottom
        function checkScrollPosition() {
            
            // Check if the user's viewport is at the bottom of the page.
            // (The '5' is a small pixel buffer to make it trigger reliably)
            const isAtBottom = (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 5;

            if (isAtBottom && !isTimerSet) {
                // If we are at the bottom and the timer isn't set yet, start it.
                isTimerSet = true;
                
                // Set a 10-second timer (10000 milliseconds)
                endOfPageTimer = setTimeout(() => {
                    // After 10 seconds, add the fade-out class to the body
                    document.body.classList.add('fade-out-to-next');

                    // Set another timer to redirect *after* the fade animation is complete
                    // The duration (1500ms) must match the CSS transition duration above
                    setTimeout(() => {
                        window.location.href = nextActUrl;
                    }, 1500);

                }, 5000); 

            } else if (!isAtBottom && isTimerSet) {
                // If the user scrolls back up, cancel the timer and reset the flag
                clearTimeout(endOfPageTimer);
                isTimerSet = false;
            }
        }

        // Add an event listener that calls our function every time the user scrolls
        window.addEventListener('scroll', checkScrollPosition);
    })();
</script>
</body>
</html>

